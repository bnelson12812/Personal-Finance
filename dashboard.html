<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Finance Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg:           #F6F4EF;
      --surface:      #FFFFFF;
      --ink:          #1C1C1A;
      --ink-muted:    #7A7A72;
      --accent:       #2D5A3D;
      --accent-light: #EBF2ED;
      --border:       #E2DFD8;
      --positive:     #2D5A3D;
      --negative:     #B94040;
      --debit-color:  #4A7C59;
      --credit-color: #C47B2B;
    }

    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--bg);
      color: var(--ink);
      min-height: 100vh;
    }

    /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
    header {
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      padding: 0 32px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .logo {
      font-family: 'DM Serif Display', serif;
      font-size: 1.25rem;
      color: var(--ink);
    }
    .logo span { color: var(--accent); }

    .header-right {
      display: flex;
      align-items: center;
      gap: 20px;
      font-size: 0.85rem;
      color: var(--ink-muted);
    }

    .logout-btn {
      background: none;
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 6px 14px;
      font-family: 'DM Sans', sans-serif;
      font-size: 0.82rem;
      color: var(--ink-muted);
      cursor: pointer;
      transition: all 0.15s;
    }
    .logout-btn:hover { border-color: var(--ink-muted); color: var(--ink); }

    /* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 32px 24px;
    }

    /* ‚îÄ‚îÄ UPLOAD SECTION ‚îÄ‚îÄ */
    .upload-section {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 32px;
      margin-bottom: 28px;
      animation: fadeUp 0.35s ease both;
    }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(12px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .upload-section h2 {
      font-family: 'DM Serif Display', serif;
      font-size: 1.1rem;
      font-weight: 400;
      margin-bottom: 20px;
    }

    .upload-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    .upload-box {
      border: 1.5px dashed var(--border);
      border-radius: 10px;
      padding: 24px;
      text-align: center;
      cursor: pointer;
      transition: all 0.15s;
      position: relative;
    }
    .upload-box:hover { border-color: var(--accent); background: var(--accent-light); }
    .upload-box.loaded { border-color: var(--accent); border-style: solid; background: var(--accent-light); }

    .upload-box input[type="file"] {
      position: absolute;
      inset: 0;
      opacity: 0;
      cursor: pointer;
      width: 100%;
      height: 100%;
    }

    .upload-icon { font-size: 1.8rem; margin-bottom: 8px; }
    .upload-label { font-size: 0.85rem; font-weight: 500; color: var(--ink); }
    .upload-sub   { font-size: 0.78rem; color: var(--ink-muted); margin-top: 4px; }
    .upload-status { font-size: 0.8rem; color: var(--accent); font-weight: 500; margin-top: 6px; }

    .load-btn {
      margin-top: 20px;
      padding: 12px 28px;
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 7px;
      font-family: 'DM Sans', sans-serif;
      font-size: 0.92rem;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.15s, transform 0.1s;
    }
    .load-btn:hover   { background: #234930; }
    .load-btn:active  { transform: scale(0.98); }
    .load-btn:disabled { background: var(--border); color: var(--ink-muted); cursor: not-allowed; }

    /* ‚îÄ‚îÄ METRICS ‚îÄ‚îÄ */
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      margin-bottom: 24px;
      animation: fadeUp 0.4s ease 0.1s both;
    }

    .metric-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 22px 24px;
    }

    .metric-label {
      font-size: 0.75rem;
      font-weight: 500;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: var(--ink-muted);
      margin-bottom: 8px;
    }

    .metric-value {
      font-family: 'DM Serif Display', serif;
      font-size: 1.7rem;
      color: var(--ink);
      line-height: 1;
    }

    .metric-value.positive { color: var(--positive); }
    .metric-value.negative { color: var(--negative); }
    .metric-sub { font-size: 0.78rem; color: var(--ink-muted); margin-top: 6px; }

    /* ‚îÄ‚îÄ CHARTS GRID ‚îÄ‚îÄ */
    .charts-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 24px;
      animation: fadeUp 0.4s ease 0.2s both;
    }

    .chart-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 24px;
    }

    .chart-card.full-width {
      grid-column: 1 / -1;
    }

    .chart-title {
      font-size: 0.8rem;
      font-weight: 500;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: var(--ink-muted);
      margin-bottom: 20px;
    }

    .chart-wrap { position: relative; height: 240px; }
    .chart-wrap.tall { height: 300px; }

    /* ‚îÄ‚îÄ FILTERS ‚îÄ‚îÄ */
    .filters-row {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    select, .filter-select {
      padding: 8px 12px;
      border: 1px solid var(--border);
      border-radius: 6px;
      font-family: 'DM Sans', sans-serif;
      font-size: 0.85rem;
      color: var(--ink);
      background: var(--surface);
      outline: none;
      cursor: pointer;
    }
    select:focus { border-color: var(--accent); }

    /* ‚îÄ‚îÄ TRANSACTIONS TABLE ‚îÄ‚îÄ */
    .table-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      overflow: hidden;
      animation: fadeUp 0.4s ease 0.3s both;
    }

    .table-header {
      padding: 20px 24px 16px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 12px;
    }

    .table-title {
      font-size: 0.8rem;
      font-weight: 500;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: var(--ink-muted);
    }

    .table-scroll { overflow-x: auto; }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.875rem;
    }

    thead th {
      padding: 10px 16px;
      text-align: left;
      font-size: 0.72rem;
      font-weight: 500;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: var(--ink-muted);
      background: var(--bg);
      border-bottom: 1px solid var(--border);
    }

    tbody tr { border-bottom: 1px solid var(--border); transition: background 0.1s; }
    tbody tr:last-child { border-bottom: none; }
    tbody tr:hover { background: var(--bg); }

    td { padding: 11px 16px; color: var(--ink); }

    .badge {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .badge-debit   { background: #EBF2ED; color: var(--accent); }
    .badge-credit  { background: #FDF3E7; color: var(--credit-color); }
    .badge-transfer { background: #F0F0EC; color: var(--ink-muted); }

    .amount-debit  { color: var(--negative); font-weight: 500; }
    .amount-credit { color: var(--positive); font-weight: 500; }

    /* ‚îÄ‚îÄ EMPTY / LOADING STATES ‚îÄ‚îÄ */
    #dashboard { display: none; }

    .empty-state {
      text-align: center;
      padding: 48px 24px;
      color: var(--ink-muted);
    }
    .empty-state .icon { font-size: 2.5rem; margin-bottom: 12px; }
    .empty-state p { font-size: 0.9rem; line-height: 1.6; }

    /* ‚îÄ‚îÄ TABS ‚îÄ‚îÄ */
    .tabs {
      display: flex;
      gap: 4px;
      margin-bottom: 20px;
      border-bottom: 1px solid var(--border);
      animation: fadeUp 0.4s ease 0.15s both;
    }

    .tab-btn {
      padding: 10px 18px;
      border: none;
      background: none;
      font-family: 'DM Sans', sans-serif;
      font-size: 0.875rem;
      color: var(--ink-muted);
      cursor: pointer;
      border-bottom: 2px solid transparent;
      margin-bottom: -1px;
      transition: all 0.15s;
    }
    .tab-btn:hover  { color: var(--ink); }
    .tab-btn.active { color: var(--accent); border-bottom-color: var(--accent); font-weight: 500; }

    .tab-panel { display: none; }
    .tab-panel.active { display: block; }

    /* ‚îÄ‚îÄ CATEGORY LIST ‚îÄ‚îÄ */
    .category-list { display: flex; flex-direction: column; gap: 10px; }

    .category-row {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 0.875rem;
    }

    .category-name { flex: 1; color: var(--ink); }
    .category-amount { font-weight: 500; color: var(--ink); min-width: 80px; text-align: right; }
    .category-bar-wrap { flex: 2; height: 6px; background: var(--bg); border-radius: 3px; overflow: hidden; }
    .category-bar { height: 100%; background: var(--accent); border-radius: 3px; transition: width 0.6s ease; }

    @media (max-width: 768px) {
      .upload-grid, .charts-grid, .metrics-grid { grid-template-columns: 1fr; }
      .chart-card.full-width { grid-column: 1; }
    }
  </style>
</head>
<body>

<!-- HEADER -->
<header>
  <div class="logo">Finance <span>Dashboard</span></div>
  <div class="header-right">
    <span id="welcomeUser"></span>
    <button class="logout-btn" onclick="logout()">Sign out</button>
  </div>
</header>

<div class="container">

  <!-- UPLOAD SECTION -->
  <div class="upload-section">
    <h2>Upload Your Bank Exports</h2>
    <div class="upload-grid">
      <div class="upload-box" id="debitBox">
        <input type="file" accept=".csv" id="debitFile" onchange="fileSelected('debit', this)"/>
        <div class="upload-icon">üè¶</div>
        <div class="upload-label">Checking / Debit Account</div>
        <div class="upload-sub">CSV export from your bank</div>
        <div class="upload-status" id="debitStatus"></div>
      </div>
      <div class="upload-box" id="creditBox">
        <input type="file" accept=".csv" id="creditFile" onchange="fileSelected('credit', this)"/>
        <div class="upload-icon">üí≥</div>
        <div class="upload-label">Credit Card Account</div>
        <div class="upload-sub">CSV export from your bank</div>
        <div class="upload-status" id="creditStatus"></div>
      </div>
    </div>
    <button class="load-btn" id="loadBtn" onclick="processFiles()" disabled>Load Dashboard</button>
  </div>

  <!-- DASHBOARD (hidden until data loaded) -->
  <div id="dashboard">

    <!-- TABS -->
    <div class="tabs">
      <button class="tab-btn active" onclick="switchTab('overview')">Overview</button>
      <button class="tab-btn" onclick="switchTab('categories')">Categories</button>
      <button class="tab-btn" onclick="switchTab('transactions')">Transactions</button>
    </div>

    <!-- OVERVIEW TAB -->
    <div class="tab-panel active" id="tab-overview">

      <!-- METRICS -->
      <div class="metrics-grid">
        <div class="metric-card">
          <div class="metric-label">Total Income</div>
          <div class="metric-value positive" id="metricIncome">‚Äî</div>
          <div class="metric-sub">Credits received</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">Total Expenses</div>
          <div class="metric-value" id="metricExpenses">‚Äî</div>
          <div class="metric-sub">Debits (excl. transfers)</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">Net Cash Flow</div>
          <div class="metric-value" id="metricNet">‚Äî</div>
          <div class="metric-sub">Income minus expenses</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">Savings Rate</div>
          <div class="metric-value" id="metricSavings">‚Äî</div>
          <div class="metric-sub">% of income saved</div>
        </div>
      </div>

      <!-- CHARTS -->
      <div class="charts-grid">
        <div class="chart-card">
          <div class="chart-title">Monthly Cash Flow</div>
          <div class="chart-wrap"><canvas id="cashflowChart"></canvas></div>
        </div>
        <div class="chart-card">
          <div class="chart-title">Spending by Account</div>
          <div class="chart-wrap"><canvas id="accountChart"></canvas></div>
        </div>
        <div class="chart-card full-width">
          <div class="chart-title">Monthly Expenses by Category</div>
          <div class="chart-wrap tall"><canvas id="categoryMonthlyChart"></canvas></div>
        </div>
      </div>
    </div>

    <!-- CATEGORIES TAB -->
    <div class="tab-panel" id="tab-categories">
      <div class="charts-grid">
        <div class="chart-card">
          <div class="chart-title">Spending Breakdown</div>
          <div class="chart-wrap tall"><canvas id="categoryPieChart"></canvas></div>
        </div>
        <div class="chart-card">
          <div class="chart-title">Top Categories</div>
          <div class="chart-wrap tall" style="overflow-y:auto;height:300px;">
            <div class="category-list" id="categoryList"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- TRANSACTIONS TAB -->
    <div class="tab-panel" id="tab-transactions">
      <div class="table-card">
        <div class="table-header">
          <div class="table-title">All Transactions</div>
          <div class="filters-row">
            <select id="filterMonth" onchange="renderTable()">
              <option value="all">All Months</option>
            </select>
            <select id="filterAccount" onchange="renderTable()">
              <option value="all">Both Accounts</option>
              <option value="debit">Debit Only</option>
              <option value="credit">Credit Only</option>
            </select>
            <select id="filterType" onchange="renderTable()">
              <option value="all">All Types</option>
              <option value="expense">Expenses</option>
              <option value="income">Income</option>
            </select>
          </div>
        </div>
        <div class="table-scroll">
          <table>
            <thead>
              <tr>
                <th>Date</th>
                <th>Description</th>
                <th>Category</th>
                <th>Account</th>
                <th>Debit</th>
                <th>Credit</th>
              </tr>
            </thead>
            <tbody id="tableBody"></tbody>
          </table>
        </div>
      </div>
    </div>

  </div><!-- /#dashboard -->
</div><!-- /.container -->

<script src="config.js"></script>
<script src="app.js"></script>
</body>
</html>
